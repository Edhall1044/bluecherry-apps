#!/usr/bin/make -f
PACKAGE = bluecherry

DIST =	lucid \
	precise \
	squeeze

ARCH = i386 amd64

O = ../releases

#### Magic suff from here ####
VERSION := $(shell git describe | sed 's/^v//;s/-g[0-9a-f]*$$//')


all: release-all FORCE

##
## GEN_REL_TARGET dist arch
##
define GEN_REL_TARGET
release-all: release-$1_$2
release-$1_$2: FORCE
	mkdir -p $O/$1
	schroot -c $1_$2 -u root fakeroot debian/rules clean
	schroot -c $1_$2 -u root fakeroot debian/rules binary
	mv ../$(PACKAGE)_$(VERSION)_$2.deb $O/$1

endef

$(eval $(foreach dist,$(DIST),$(foreach arch,$(ARCH),\
$(call GEN_REL_TARGET,$(dist),$(arch)))))

release-all: FORCE
	md5sum $O/*/* >> $O/md5sum.txt

FORCE:
